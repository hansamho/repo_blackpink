<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hotelstay.infra.booking.BookingDao">

	<resultMap id="resultMapObj"
		type="com.hotelstay.infra.booking.BookingDto"></resultMap>

	<select id="selectMy" resultMap="resultMapObj">
		SELECT
			a.memberSeq
			,a.memberName
	        ,a.birthday
	        ,a.memberPhone
            ,a.codeNumber
			,a.addrDetail
			,a.roadName
	        ,b.member_seq as memberSeqF
	        ,b.bkCheckin
	        ,b.bkCheckout
	        ,b.bkAdult
	        ,b.bkChild
	        ,b.bkTotalPrice	       
	        ,c.roomName
	        ,c.roomTypeCD
	        ,c.roomPrice
            ,c.roomRegDate
	        ,c.roomSeq
			,b.roomDetail_roomSeq as roomSeqF
			,c.hotelList_seq as hotelListSeqF
		FROM member a
		LEFT JOIN hotelbooking b on b.member_seq = a.memberSeq
		LEFT JOIN roomdetail c on b.roomDetail_roomSeq = c.roomSeq
		WHERE 1=1
		AND a.memberSeq = #{memberSeqF}
	</select>

	<select id="selectOne" resultMap="resultMapObj">
		SELECT
			a.memberSeq
			,a.memberName
	        ,a.birthday
	        ,a.memberPhone
            ,a.codeNumber
			,a.addrDetail
			,a.roadName
		FROM member a
		WHERE 1=1
		AND a.memberSeq =  #{memberSeqF};
	</select>

	<select id="selectWish" resultMap="resultMapObj">
		SELECT
		a.member_seq as memberSeqF
		,c.roomName
		,c.roomPrice
		,c.roomTotalRating
		FROM wishlist a
		LEFT JOIN member b
		on a.wishSeq = b.memberSeq
		LEFT JOIN roomDetail c
		on a.wishSeq = c.roomSeq
		WHERE member_seq = #{memberSeqF};

	</select>

	<update id="memberUpdate">
		UPDATE member
		set
		memberName = #{memberName}
		,birthday = #{birthday}
		,memberPhone = #{memberPhone}
		,codeNumber = #{codeNumber}
		,roadName = #{roadName}
		,addrDetail = #{addrDetail}
		WHERE memberSeq = #{memberSeqF}
	</update>
	
	<select id="bookingSelectList" resultMap="resultMapObj">
		SELECT
			a.bookingSeq
			,a.bkAdult
	        ,a.bkChild
	        ,a.bkCheckIn
	        ,a.bkCheckOut
	        ,a.bkTotalPrice
	        ,a.singleRoomPrice
	        ,a.doubleRoomPrice
	        ,a.twinRoomPrice
	        ,a.member_seq as memberSeqF
	        ,e.memberName
		 from hotelbooking a
        left join bookingpay c on a.bookingSeq = c.hotelBooking_bookingSeq
        left join payment d on d.paySeq =c.payment_paySeq
        left join member e on a.member_seq = e.memberSeq
		WHERE 1=1
	</select>
	
	
	
	
	
	<select id="bookingSelectOne" resultMap="resultMapObj">
		 SELECT 
			b.bookingSeq
			,a.memberSeq
			,a.memberName
			,b.bkAdult
			,b.bkChild
			,b.bkCheckIn
			,b.bkCheckOut
			,b.member_seq as memberSeqF
			,b.singleRoomPrice
			,b.doubleRoomPrice
			,b.twinRoomPrice
			,b.bkTotalPrice
			,b.member_seq as memberSeqF
        FROM member a
        LEFT JOIN hotelbooking b on b.member_seq = a.memberSeq
        WHERE 1=1
        AND b.bookingSeq = #{bookingSeq}
	</select>
	
	
	<insert id="bookingInsert" 
	parameterType = "com.hotelstay.infra.booking.BookingDto">
		<selectKey resultType ="String" keyProperty="bookingSeq" order="AFTER">
		SELECT LAST_INSERT_ID()
		</selectKey>
		INSERT INTO hotelBooking(
			bkCheckIn
			,bkCheckOut
			,bkAdult
			,bkChild
			,singleRoomPrice
			,doubleRoomPrice
			,twinRoomPrice
			,member_seq
			,roomDetail_roomSeq 
		)VALUE(
			#{bkCheckIn}
			,#{bkCheckOut}
			,#{bkAdult}
			,#{bkChild}
			,#{singleRoomPrice}
			,#{doubleRoomPrice}
			,#{twinRoomPrice}
			,#{memberSeqF}
			,#{roomSeqF}
		)
	</insert>
	
</mapper>