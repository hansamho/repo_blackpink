<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hotelstay.infra.hotel.HotelDao">

	<resultMap id="resultMapObj" type="com.hotelstay.infra.hotel.HotelDto"></resultMap>
	
	 
	<sql id ="selectCommon">
         FROM hotellist a
         LEFT JOIN roomdetail b on a.hotelSeq = b.roomSeq
         LEFT JOIN hotelbooking c on b.roomSeq = c.bookingSeq
        WHERE 1=1
        	
        	<!-- list 조건에 맞는 화면 띄우기 -->
        	<if test="hotelTypeCD != null and !hotelTypeCD.equals('')">AND a.hotelTypeCD = #{hotelTypeCD}</if>
        	<if test="areaCD != null and !areaCD.equals('')">AND a.areaCD = #{areaCD}</if> 
<!--         	<if test="roomTypeCD != null and !roomTypeCD.equals('')">AND a.roomTypeCD = #{roomTypeCD}</if> -->
        	
        	<!-- 지역 검색 -->
        	<if test="shAreaCD != null and !shAreaCD.equals('')">AND a.areaCD = #{shAreaCD}</if> 
        	
        	<!-- 체크인 체크아웃 -->
<!--         	<if test="shCheckIn != null and !shAreaCD.equals('')" >AND c.bkCheckIn = #{shCheckIn}></if> -->
<!--         	<if test="shCheckOut != null and !shAreaCD.equals('')" >AND c.bkCheckOut = #{shCheckOut}></if> -->
			
			<!-- 체크박스 호텔 유형  -->
			<if test="shCheckboxHotelTypeArray != null and shCheckboxHotelTypeArray.length != 0">
				AND a.hotelTypeCD IN
			<foreach collection="shCheckboxHotelTypeArray" item="type" open="(" close=")" separator=",">
		       #{type}
			</foreach> 		              	
			</if>
			
			<!-- 체크박스 지역 -->
			<if test="shCheckboxAreaArray != null and shCheckboxAreaArray.length != 0">
				AND a.areaCD IN
			<foreach collection="shCheckboxAreaArray" item="type" open="(" close=")" separator=",">
		       #{type}
			</foreach> 		              	
			</if>
			
<!-- 			<if test="shCheckboxRoomArray != null and shCheckboxRoomArray.length != 0"> -->
<!-- 				AND tvNy IN -->
<!-- 			<foreach collection="shCheckboxRoomArray" item="type" open="(" close=")" separator=","> -->
<!-- 		       #{type} -->
<!-- 			</foreach> 		              	 -->
<!-- 			</if> -->

				<choose>
            <when test="shOption == 1">AND a.hotelSeq = #{shValue}</when>
            <when test="shOption == 2">AND a.hotelName LIKE CONCAT('%',#{shValue},'%')</when>
            <when test="shOption == 3">AND b.roomName LIKE CONCAT('%',#{shValue},'%')</when>
            <when test="shOption == 4">AND b.roomPrice LIKE CONCAT('%',#{shValue},'%')</when>
        </choose>
       </sql>
	
	 <select id="selectList" resultMap="resultMapObj">
       SELECT
        	a.hotelSeq
			,a.hotelName
    		,a.hotelContent
    		,a.hotelRating
    		,a.hotelTypeCD
    		,a.areaCD
    		,a.htRegDate
    		,a.htUpDate
    		,a.htDelny
    		,b.roomName
    		,b.roomPrice
   		 	,b.roomTypeCD
   		 	,b.roomTotalRating
   		 	,b.tvNy
            ,b.wifiNy
            ,b.poolNy
            ,b.bathNy
            ,b.bathSuppliesNy
            ,b.airNy
    		,b.roomSeq
    		,c.bkCheckIn
    		,c.bkCheckOut
    		,b.hotelList_seq as hotelSeq
        	<include refid="selectCommon" />
        ORDER BY a.hotelSeq DESC
        limit #{rowNumToShow} offset #{startRnumForMysql}
    </select>
    
    <select id="selectOneCount" resultType="Integer">
		SELECT COUNT(*)
		<include refid="selectCommon" />
	</select>
    
    <select id="selectOne" resultMap="resultMapObj">
        SELECT
           a.hotelSeq
            ,a.hotelName
            ,a.hotelContent
            ,a.hotelRating
            ,a.areaCD
            ,a.hotelTypeCD
            ,a.htRegDate
            ,a.htUpdate
            ,a.htDelny
            ,b.roomPrice
            ,b.roomName
         FROM hotellist a
         LEFT JOIN roomdetail b on a.hotelSeq = b.roomSeq
        WHERE 1=1
        AND a.hotelSeq = #{hotelSeq}
    </select>
    
    
    <insert id="roomInsert">
    	INSERT INTO roomdetail(
    		roomName
    		,roomTypeCD
    		,roomPrice
    		,hotelList_seq
    	)VALUES(
    		#{roomName}
    		,#{roomTypeCD}
    		,#{roomPrice}
    		,#{hotelList_seq}
    	)
    
    </insert>
    
    <insert id="imageUpload">
   		INSERT INTO imageloaded(
   			originalName
   			,path
   			,uuidName
   			,ext
   			,size
   			,pseq
   		)VALUES(
   			#{originalName}
   			,#{path}
   			,#{uuidName}
   			,#{ext}
   			,#{size}
   			,#{pseq}
   		)
   	</insert>
    
    <select id="uploadOne" resultMap="resultMapObj">
    	SELECT 
    	a.path
    	FROM imageloaded a
    	LEFT JOIN codeGroup b on a.seq = b.cgSeq
    	WHERE 1=1
    	AND a.seq = #{cgSeq}
    
    </select>
    
</mapper>